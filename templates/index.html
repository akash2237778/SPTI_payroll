{% extends 'base.html' %}

{% block content %}
<div class="dashboard-grid">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">
            <div class="logo-icon"></div>
            <div class="logo-text">SPTI Payroll</div>
        </div>

        <nav style="display: flex; flex-direction: column; gap: 1rem;">
            <div
                style="background: rgba(139, 92, 246, 0.1); color: #c4b5fd; padding: 1rem; border-radius: 12px; font-weight: 500; border: 1px solid rgba(139, 92, 246, 0.2); cursor: pointer;">
                üìä Dashboard
            </div>
            <a href="{% url 'monthly_report' %}" style="text-decoration: none;">
                <div style="padding: 1rem; color: var(--text-secondary); cursor: pointer; transition: 0.3s;"
                    onmouseover="this.style.color='white'" onmouseout="this.style.color='#9ca3af'">
                    üìÖ Monthly Report
                </div>
            </a>
            <div style="padding: 1rem; color: var(--text-secondary); cursor: pointer; transition: 0.3s;"
                onmouseover="this.style.color='white'" onmouseout="this.style.color='#9ca3af'">
                ‚öôÔ∏è Settings
            </div>
        </nav>

        <div style="margin-top: auto; padding-top: 2rem; color: var(--text-secondary); font-size: 0.8rem;">
            <div>System Status: <span style="color: #34d399">‚óè Online</span></div>
            <div style="margin-top: 0.5rem;">v1.0.2 Prod</div>
        </div>
    </aside>

    <!-- Main -->
    <main class="main-content">
        <div class="sync-section">
            <div>
                <h1 style="margin: 0; font-size: 2rem; font-weight: 700;">Dashboard</h1>
                <p style="color: var(--text-secondary); margin-top: 0.5rem;">Welcome back, Admin</p>
            </div>
            <div>
                <button id="syncBtn" class="btn-glow">
                    <span class="loading-ring" id="syncSpinner"></span>
                    <span id="syncText">Sync Now</span>
                    <span style="font-size: 1.2rem;">‚ö°</span>
                </button>
            </div>
        </div>

        <div class="stats-row">
            <div class="glass-card">
                <div class="card-icon">üë•</div>
                <div class="stat-label">Total Staff</div>
                <div class="stat-value">{{ total_employees }}</div>
            </div>
            <div class="glass-card">
                <div class="card-icon">üìÖ</div>
                <div class="stat-label">Present Today</div>
                <div class="stat-value">{{ logs_today_count }}</div>
            </div>
            <div class="glass-card">
                <div class="card-icon">‚è±Ô∏è</div>
                <div class="stat-label">Last Sync</div>
                <div class="stat-value" style="font-size: 1.5rem; line-height: 3rem;">
                    {{ last_sync_time|date:"H:i"|default:"--" }}
                </div>
                <div style="font-size: 0.8rem; color: var(--text-secondary);">
                    {{ last_sync_time|date:"d M Y" }}
                </div>
            </div>
        </div>

        <div class="table-wrapper">
            <div class="table-header">
                <h2 class="table-title">Today's Attendance</h2>
                <button
                    style="background: transparent; border: 1px solid var(--border-glass); color: var(--text-secondary); padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">View
                    Report</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Employee</th>
                        <th>Status</th>
                        <th>First In</th>
                        <th>Last Out</th>
                        <th>Duration</th>
                    </tr>
                </thead>
                <tbody>
                    {% for summary in daily_summaries %}
                    <tr>
                        <td style="font-weight: 500; color: white;">
                            <div style="display: flex; align-items: center; gap: 0.8rem;">
                                <div
                                    style="width: 32px; height: 32px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem;">
                                    {{ summary.employee.name|make_list|first }}
                                </div>
                                <div>
                                    <div style="line-height: 1;">{{ summary.employee.name }}</div>
                                    <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 2px;">ID:
                                        {{ summary.employee.employee_id }}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            {% if summary.is_overtime %}
                            <span class="status-badge status-in">Overtime</span>
                            {% else %}
                            <span class="status-badge"
                                style="background: rgba(255,255,255,0.1); color: #fff;">Regular</span>
                            {% endif %}
                        </td>
                        <td style="font-family: 'Space Grotesk';">{{ summary.first_check_in|default:"-" }}</td>
                        <td style="font-family: 'Space Grotesk';">{{ summary.last_check_out|default:"-" }}</td>
                        <td style="font-family: 'Space Grotesk'; color: #c4b5fd;">{{ summary.total_hours }} hrs</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                            No active attendance records for today.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="table-wrapper">
            <div class="table-header">
                <h2 class="table-title">Live Device Stream</h2>
                <span class="status-badge status-in" style="font-size: 0.7rem; padding: 0.2rem 0.6rem;">‚óè Live</span>
            </div>
            <table>
                <thead>
                    <tr>
                        <th width="20%">Timestamp</th>
                        <th>Employee</th>
                        <th>Type</th>
                        <th>Device Info</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in recent_logs %}
                    <tr>
                        <td style="font-family: 'Space Grotesk'; color: var(--text-secondary);">
                            {{ log.timestamp|date:"H:i:s" }}
                        </td>
                        <td>{{ log.employee.name }}</td>
                        <td>
                            {% if log.status == 0 %}
                            <span style="color: #34d399">‚Üí Check In</span>
                            {% elif log.status == 1 %}
                            <span style="color: #f87171">‚Üê Check Out</span>
                            {% else %}
                            <span style="color: #fbbf24">Punch ({{ log.status }})</span>
                            {% endif %}
                        </td>
                        <td style="color: var(--text-secondary); font-size: 0.8rem;">
                            ZK-Bio (Mode: {{ log.verification_mode }})
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </main>
</div>
{% endblock %}