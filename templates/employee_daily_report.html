{% extends 'base.html' %}

{% block content %}
<div class="dashboard-grid">
    <!-- Sidebar (Shared) -->
    <aside class="sidebar">
        <div class="logo">
            <div class="logo-icon"></div>
            <div class="logo-text">SPTI Payroll</div>
        </div>

        <nav style="display: flex; flex-direction: column; gap: 1rem;">
            <a href="{% url 'dashboard' %}" style="text-decoration: none;">
                <div style="padding: 1rem; color: var(--text-secondary); cursor: pointer; transition: 0.3s;"
                    onmouseover="this.style.color='white'" onmouseout="this.style.color='#9ca3af'">
                    üìä Dashboard
                </div>
            </a>
            <a href="{% url 'monthly_report' %}" style="text-decoration: none;">
                <div style="padding: 1rem; color: var(--text-secondary); cursor: pointer; transition: 0.3s;"
                    onmouseover="this.style.color='white'" onmouseout="this.style.color='#9ca3af'">
                    üìÖ Monthly Report
                </div>
            </a>
        </nav>

        <div style="margin-top: auto; padding-top: 2rem; color: var(--text-secondary); font-size: 0.8rem;">
            <div>System Status: <span style="color: #34d399">‚óè Online</span></div>
            <div style="margin-top: 0.5rem;">v1.1.0 Report</div>
        </div>
    </aside>

    <!-- Main -->
    <main class="main-content">
        <div class="sync-section">
            <div>
                <a href="{% url 'monthly_report' %}?month={{ month }}&year={{ year }}"
                    style="color: var(--text-secondary); text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;"
                    onmouseover="this.style.color='white'" onmouseout="this.style.color='#9ca3af'">
                    ‚Üê Back to Monthly Report
                </a>
                <h1 style="margin: 0; font-size: 2rem; font-weight: 700;">{{ employee.name }}</h1>
                <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                    Employee ID: {{ employee.employee_id }} | {{ month_name }} {{ year }}
                </p>
            </div>
            <div>
                <a href="?month={{ prev_month }}&year={{ prev_year }}" class="btn-glow"
                    style="padding: 0.5rem 1rem; font-size: 0.9rem; text-decoration: none; display: inline-flex;">‚Üê
                    Prev</a>
                <span style="color: var(--text-primary); margin: 0 1rem; font-weight: 600;">
                    {{ month_name }} {{ year }}
                </span>
                <a href="?month={{ next_month }}&year={{ next_year }}" class="btn-glow"
                    style="padding: 0.5rem 1rem; font-size: 0.9rem; text-decoration: none; display: inline-flex;">Next
                    ‚Üí</a>
            </div>
        </div>

        <!-- Summary Stats -->
        <div
            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
            <div class="stat-card">
                <div class="stat-label">Total Days Present</div>
                <div class="stat-value">{{ total_days }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Hours</div>
                <div class="stat-value">{{ total_hours }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Overtime Hours</div>
                <div class="stat-value"
                    style="color: {% if overtime_hours > 0 %}#fccb00{% else %}var(--text-secondary){% endif %}">
                    {{ overtime_hours }}
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Avg Hours/Day</div>
                <div class="stat-value">{{ avg_hours }}</div>
            </div>
        </div>

        <div class="table-wrapper">
            <div class="table-header">
                <h2 class="table-title">Daily Attendance Details</h2>
                <button
                    style="background: var(--primary); color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-weight: 600;">Export
                    CSV</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>First Check-In</th>
                        <th>Last Check-Out</th>
                        <th>Total Hours</th>
                        <th>All Punches</th>
                    </tr>
                </thead>
                <tbody>
                    {% for day in daily_data %}
                    <tr>
                        <td style="font-weight: 500; color: white;">
                            {{ day.date|date:"D, M d, Y" }}
                        </td>
                        <td style="font-family: 'Space Grotesk'; color: #34d399;">
                            {{ day.first_check_in|default:"‚Äî" }}
                        </td>
                        <td style="font-family: 'Space Grotesk'; color: #f87171;">
                            {{ day.last_check_out|default:"‚Äî" }}
                        </td>
                        <td
                            style="font-family: 'Space Grotesk'; color: {% if day.is_overtime %}#fccb00{% else %}#c4b5fd{% endif %};">
                            {{ day.total_hours }} hrs
                            {% if day.is_overtime %}
                            <span
                                style="font-size: 0.7rem; background: rgba(252, 203, 0, 0.1); padding: 2px 6px; border-radius: 4px; margin-left: 4px;">OT</span>
                            {% endif %}
                        </td>
                        <td>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                {% for log in day.logs %}
                                <span
                                    style="font-size: 0.75rem; background: rgba(139, 92, 246, 0.1); color: #c4b5fd; padding: 4px 8px; border-radius: 6px; font-family: 'Space Grotesk';">
                                    {{ log.timestamp|date:"H:i:s" }}
                                </span>
                                {% empty %}
                                <span style="color: var(--text-secondary); font-size: 0.85rem;">No detailed logs</span>
                                {% endfor %}
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                            No attendance data found for this employee in {{ month_name }} {{ year }}.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </main>
</div>
{% endblock %}